@using Microsoft.AspNetCore.Identity
@using Mtd.OrderMaker.Server.Areas.Identity.Data
@inject SignInManager<WebAppUser> SignInManager
@inject UserManager<WebAppUser> UserManager
@inject Server.Services.ConfigHandler configHandler;

@using Microsoft.AspNetCore.Mvc.Localization
@inject IHtmlLocalizer<SharedResource> Localizer

@{
    string userName = "";
    string userEmail = "";
    string userCheck = "";
    bool isAdmin = false;

    var user = await UserManager.GetUserAsync(User);

    if (user != null)
    {
        userName = user.Title;
        userEmail = user.Email;
        userCheck = user.EmailConfirmed ? "green" : "red";
        isAdmin = User.IsInRole("Admin");
        var list = await UserManager.GetClaimsAsync(user);

        if (list.Where(x => x.Type == "revoke").Any())
        {
            Context.Response.Redirect("/Identity/Account/Relogin");
        }

    }
}

<aside class="mdc-drawer mdc-drawer--modal">
    <div class="mdc-drawer__content">
        <div style="padding-top: 16px; padding-bottom: 16px;">
            <div style="display:flex; flex-direction: column; align-items: center">
                <div>
                    @{
                        string pathImgMenu = "/lib/mtd-ordermaker/images/logo-mtd.png";
                        var imgMenu = await configHandler.GetImageFromConfig(configHandler.CodeImgMenu);
                        if (imgMenu != string.Empty) { pathImgMenu = imgMenu; }
                    }
                    <img src="@pathImgMenu" width="235" />
                </div>
                <div style="display: flex; flex-direction: column; margin-top: 16px; align-items: center">
                    <div style="background-color: lightgray;   width: 52px; height: 52px; border-radius: 50%; text-align: center">
                        <i class="material-icons" style="font-size: 48px; color: white">person</i>
                    </div>
                    <div style="color: gray; text-align: center">
                        <div>
                            @userName
                        </div>
                        <div>
                            @userEmail
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr />
        <nav class="mdc-list" tabindex="0">
            <a id="menu-desk" class="mdc-list-item" href="/" aria-selected="true">
                <span class="mdc-list-item__ripple"></span>
                <i class="material-icons mdc-list-item__graphic" aria-hidden="true">dashboard</i>
                <span class="mdc-list-item__text">@Localizer["Desktop"]</span>
            </a>
            <a id="menu-account" class="mdc-list-item" href="/Identity/Account/Manage" aria-selected="true">
                <span class="mdc-list-item__ripple"></span>
                <i class="material-icons mdc-list-item__graphic" aria-hidden="true">person_outline</i>
                <span class="mdc-list-item__text">@Localizer["Account"]</span>
            </a>

            @if (@isAdmin)
            {
                <a id="menu-config" class="mdc-list-item" href="/Config" aria-selected="true">
                    <span class="mdc-list-item__ripple"></span>
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">settings</i>
                    <span class="mdc-list-item__text">@Localizer["Configurator"]</span>
                </a>
                <a id="menu-users" class="mdc-list-item" href="/Identity/Users" aria-selected="true">
                    <span class="mdc-list-item__ripple"></span>
                    <i class="material-icons mdc-list-item__graphic" aria-hidden="true">supervisor_account</i>
                    <span class="mdc-list-item__text">@Localizer["Users"]</span>
                </a>
            }

            <hr style="display: block; height: 1px; border: 0; border-top: 1px solid #ccc; margin: 1em 0; padding: 0; " />

            <a id="menu-feedback" class="mdc-list-item" href="/Support/Feedback" aria-selected="true">
                <span class="mdc-list-item__ripple"></span>
                <i class="material-icons mdc-list-item__graphic" aria-hidden="true">announcement</i>
                <span class="mdc-list-item__text">@Localizer["Send feedback"]</span>
            </a>

        </nav>
    </div>
</aside>
